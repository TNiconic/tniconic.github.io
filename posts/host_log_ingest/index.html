<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Ingesting Host Logs" /><meta property="og:locale" content="en" /><meta name="description" content="A documentation site showcasing some of the things I’ve worked on." /><meta property="og:description" content="A documentation site showcasing some of the things I’ve worked on." /><link rel="canonical" href="https://tniconic.github.io/posts/host_log_ingest/" /><meta property="og:url" content="https://tniconic.github.io/posts/host_log_ingest/" /><meta property="og:site_name" content="Mitchell Gibson Docs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-11T13:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Ingesting Host Logs" /><meta name="twitter:site" content="@false" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-11T16:44:22-04:00","datePublished":"2022-07-11T13:00:00-04:00","description":"A documentation site showcasing some of the things I’ve worked on.","headline":"Ingesting Host Logs","mainEntityOfPage":{"@type":"WebPage","@id":"https://tniconic.github.io/posts/host_log_ingest/"},"url":"https://tniconic.github.io/posts/host_log_ingest/"}</script><title>Ingesting Host Logs | Mitchell Gibson Docs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mitchell Gibson Docs"><meta name="application-name" content="Mitchell Gibson Docs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://pbs.twimg.com/profile_images/1538393772614201345/W6B-hN6q_400x400.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mitchell Gibson Docs</a></div><div class="site-subtitle font-italic">A site for all my personal projects</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/TNiconic" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/false" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mitchellgibsonnm','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Ingesting Host Logs</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Ingesting Host Logs</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1657558800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 11, 2022 </em> </span> <span> Updated <em class="" data-ts="1657572262" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 11, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Mitchell Gibson</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2651 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="/assets/post4/23.png" alt="elk" data-proofer-ignore></p><h1 id="host-log-ingestion">Host Log Ingestion</h1><p>Hello! The topic of today’s discussion is host log ingestion. Specifically enterprise host log ingestion and pipeline creation into a SIEM; which in this case will be SecurityOnion2.</p><p>What is host log ingestion? Well it’s important that we first define what host logs are. Host logs are logs taken by Windows/Linux systems that are stored locally. Depending on the auditing/configuration settings, these logs correspond with different values that show the effect those systems have. For example, if logging is configured properly everytime someone opens an app, everytme someone makes a configuration change, everytime some creates and deletes a file a log will be generated. Thus host log ingestion is just putting all of these logs into our singular SIEM.</p><p>There are 2 main ways to receive these forwarded logs into a SIEM. The first is through collector initiated log aggregation where each node/computer sends its logs to the SIEM individually. This method is typically consider very cumbersome and bandwidth heavy and is not recommended due to the upkeep required of having to manually configure and monitor each host. Here is an example of what this may look like:</p><p><img data-src="/assets/post4/24.png" alt="collector" data-proofer-ignore></p><p>The other type of host log collection is source computer initiated where through group policy nodes are required to send their logs to a centralized server. This is preferable as it’s more scalable and their is less future overhead once you have it set up. An example of what this may look like is shown here:</p><p><img data-src="/assets/post4/25.png" alt="central" data-proofer-ignore></p><p>As you can imagine this type of information is incredibly valuable for cyber defenders, which is why today I’ll be guiding you through the process of centralizing those logs, and pushing them up to a SIEM like example 2.</p><h1 id="prerequisites--steps">Prerequisites / Steps</h1><p>Before we get started there are a couple of things you will need to have setup for this guide to be beneficial to you.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>You will need to have a WEC joined to an already pre-existing domain.

You will need to have a SIEM already stood up and configured. My instructions will be based on SecurityOnion2, but you can use Splunk forwarders as well.

You will need VM's also joined to the domain to gather host logs from.
</pre></table></code></div></div><p>Once you’ve met those prerequisites you’re ready to move on!</p><p>In general there are 3 main components to configuring a centralized log ingestion pipeline.</p><ol><li><p>Configure a WEC to ingest logs from all domain joined nodes.</p><li><p>Configure a group policy that forces those nodes and any nodes thereafter to be configured to send their logs to the previously configured WEC.</p><li><p>Configure additional forwarding via winlogbeat into our SIEM.</p></ol><h1 id="configuring-the-wec">Configuring the WEC</h1><p>Square one for this demonstration will be a fresh install of Windows Server 2019 that has been joined to a domain ggsec.com. Once you have logged into the domain follow these steps.</p><ol><li><p>Go into Event Viewer and click Subscriptions.</p><p>a. You will get a pop-up window saying that the Windows Event Collector Service must be running and configured. Click yes to start this service.</p></ol><p><img data-src="/assets/post4/1.png" alt="service" data-proofer-ignore></p><ol><li><p>For maximum performance you will want to increase the log size of the events that are ingested. Still in Event Viewer, go into Windows Logs and right-click on Forward Events and then click properties.</p><p>a. From here you will want to change the size of the maximum log size. The size will be dependent on the environment and the type of logs being ingested.</p><li><p>Next we will use Powershell to enable, automatically start event collection and a tweak in the way it ingests traffic. Open Powershell in an administrative shell and type the following:</p></ol><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">winrm</span><span class="w"> </span><span class="nx">quickconfig</span><span class="w"> </span><span class="nt">-quiet</span><span class="w">
</span></pre></table></code></div></div><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Set-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">WINRM</span><span class="w"> </span><span class="nt">-StartupType</span><span class="w"> </span><span class="nx">Automatic</span><span class="w">
</span></pre></table></code></div></div><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">wevtutil</span><span class="w"> </span><span class="nx">sl</span><span class="w"> </span><span class="nx">forwardedevents</span><span class="w"> </span><span class="nx">/ms:1000000000</span><span class="w">
</span></pre></table></code></div></div><ol><li>By default, Windows Server 2016/2019 has firewall rules that block forwarded logs into these deployments so we will need to open them back up. You can do this by typing the following commands in a normal command prompt (not powershell) as an administrator.</ol><pre><code class="language-cmd">netsh http delete urlacl url=http://+:5985/wsman/
</code></pre><pre><code class="language-cmd">netsh http add urlacl url=http://+:5985/wsman/ sddl=D:(A;;GX;;;S-1-5-80-569256582-2953403351-2909559716-1301513147-412116970)(A;;GX;;;S-1-5-80-4059739203-877974739-1245631912-527174227-2996563517)
</code></pre><pre><code class="language-cmd">netsh http delete urlacl url=https://+:5986/wsman/
</code></pre><pre><code class="language-cmd">netsh http add urlacl url=https://+:5986/wsman/ sddl=D:(A;;GX;;;S-1-5-80-569256582-2953403351-2909559716-1301513147-412116970)(A;;GX;;;S-1-5-80-4059739203-877974739-1245631912-527174227-2996563517)
</code></pre><ol><li><p>Back in event viewer we will turn on the ability to push logs to this server. Right-click Subscription and click Create Subscription.</p><p>a. First give the subscription an appropriate name. Next you will want to change the radial button to Source computer initiated that way computers will send their logs to this server like we previously discussed.</p><p><img data-src="/assets/post4/2.png" alt="subscription" data-proofer-ignore></p><p>b. Next we are going to specify which computer we will send logs from. Click Select Computer Groups, then in the box I typed Domain Computers and Domain Controllers which covered every node in my domain.</p><p><strong>NOTE</strong> For bigger production environments it’s reccommended to not exceed 4000 computers sending logs to 1 WEC and to instead stand up a WEC for every 4000 workstations. If this is your case, then you will need to create individual groups of 4000 machines and specify those here instead of all domain computers.</p><p>c. Next we will define which events we want to collect. Best practice is to put this into XML format. Click on the XML tab ad the top and click the radial button to edit the query manually. Once you do this you won’t be able to go back to filtered queries but that shouldn’t be a problem.</p><p><img data-src="/assets/post4/3.png" alt="xml" data-proofer-ignore></p><p>Here I input a sample query from SANS that will be a good starting point but always do further configuration based off the needs of your situation/mission.</p></ol><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre><td class="rouge-code"><pre><span class="nt">&lt;QueryList&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"0"</span> <span class="na">Path=</span><span class="s">"Security"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Security"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
    <span class="nt">&lt;Suppress</span> <span class="na">Path=</span><span class="s">"Security"</span><span class="nt">&gt;</span>*[System[EventID=4688]] and *[EventData[Data[@Name='SubjectLogonId'] = '0x3e7' and ( 
Data[@Name='NewProcessName'] = 'C:\Windows\System32\SearchFilterHost.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\SysWOW64\SearchProtocolHost.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\SearchProtocolHost.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\backgroundTaskHost.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\conhost.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\wbem\WmiPrvSE.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\taskhost.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\taskeng.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\svchost.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\sc.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\rundll32.exe' 
 or Data[@Name='NewProcessName'] = 'C:\Windows\System32\taskhostex.exe' 
)]]<span class="nt">&lt;/Suppress&gt;</span> 
    <span class="nt">&lt;Suppress</span> <span class="na">Path=</span><span class="s">"Security"</span><span class="nt">&gt;</span>(*[System[EventID=4769]] and *[EventData[Data[@Name='ServiceName'] = 'krbtgt']]) 
 or (*[System[EventID=4770]]) 
 or (*[System[EventID=4624]] and *[EventData[Data[@Name='LogonType'] = '3']]) 
 or (*[System[EventID=4634]] and *[EventData[Data[@Name='LogonType'] = '3']]) 
<span class="nt">&lt;/Suppress&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"1"</span> <span class="na">Path=</span><span class="s">"Application"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Application"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"2"</span> <span class="na">Path=</span><span class="s">"System"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"System"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"3"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-Sysmon/Operational"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-Sysmon/Operational"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"4"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-PowerShell/Operational"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-PowerShell/Operational"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"5"</span> <span class="na">Path=</span><span class="s">"Windows PowerShell"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Windows PowerShell"</span><span class="nt">&gt;</span>*[System[EventID=400]] or *[System[EventID=600]] or *[System[EventID=800]]<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"6"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-WMI-Activity/Operational"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-WMI-Activity/Operational"</span><span class="nt">&gt;</span>*[System[EventID=5857]] or *[System[EventID=5858]] or *[System[EventID=5859]] or *[System[EventID=5860]] or *[System[EventID=5861]]<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"7"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-TaskScheduler/Operational"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-TaskScheduler/Operational"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"8"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-TerminalServices-RDPClient/Operational"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-TerminalServices-RDPClient/Operational"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"9"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-TerminalServices-LocalSessionManager/Admin"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-TerminalServices-LocalSessionManager/Admin"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"10"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-TerminalServices-LocalSessionManager/Operational"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-TerminalServices-LocalSessionManager/Operational"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"11"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-GroupPolicy/Operational"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-GroupPolicy/Operational"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"12"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-DriverFrameworks-UserMode/Operational"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-DriverFrameworks-UserMode/Operational"</span><span class="nt">&gt;</span>*[System[EventID=2003]] or *[System[EventID=2004]] or *[System[EventID=2102]]<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"13"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-AppLocker/EXE and DLL"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-AppLocker/EXE and DLL"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-AppLocker/MSI and Script"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"14"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-AppLocker/Packaged app-Execution"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-AppLocker/Packaged app-Execution"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"15"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-AppLocker/Packaged app-Deployment"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-AppLocker/Packaged app-Deployment"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"16"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-SmartCard-Audit/Authentication"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-SmartCard-Audit/Authentication"</span><span class="nt">&gt;</span>*<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"17"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-SMBClient/Operational"</span><span class="nt">&gt;</span> 
    <span class="c">&lt;!-- get all UNC/mapped drive successful connection --&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-SMBClient/Operational"</span><span class="nt">&gt;</span>*[System[(EventID=30622 or EventID=30624)]]<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
  <span class="nt">&lt;Query</span> <span class="na">Id=</span><span class="s">"41"</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-Windows Defender/Operational"</span><span class="nt">&gt;</span> 
    <span class="c">&lt;!-- Modern Windows Defender event provider Detection events (1006-1009) and (1116-1119) --&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-Windows Defender/Operational"</span><span class="nt">&gt;</span>*[System[( (EventID <span class="ni">&amp;gt;</span>= 1006 and EventID <span class="ni">&amp;lt;</span>= 1009) )]]<span class="nt">&lt;/Select&gt;</span> 
    <span class="nt">&lt;Select</span> <span class="na">Path=</span><span class="s">"Microsoft-Windows-Windows Defender/Operational"</span><span class="nt">&gt;</span>*[System[( (EventID <span class="ni">&amp;gt;</span>= 1116 and EventID <span class="ni">&amp;lt;</span>= 1119) )]]<span class="nt">&lt;/Select&gt;</span> 
  <span class="nt">&lt;/Query&gt;</span> 
<span class="nt">&lt;/QueryList&gt;</span> 
</pre></table></code></div></div><ol><li><p>The last thing you will want to is click the advanced button and make sure you click the radial button to Minimize Latency and set the protocol to HTTP.</p><p><strong>NOTE</strong> While I know it may seem like we’ll be sending the logs unencrypted, due to the way kerberos and AD works, they will be encrypted, however the pipe sending them won’t be. It will be up to your risk tolerance if you do decide to encrypt your traffic.</p></ol><p>That’s it for configuring our WEC. We will have to revisit the WEC later to configure Winlogbeat but we’ll go over that in a bit. Instead we’re going to switch gears and make sure we can actually forward the logs through group policies.</p><h1 id="configuring-group-policy">Configuring Group Policy</h1><p>For the following steps you will want to login to the primary Active Directory server so that we can configure a group policy to forward host logs to the WEC we just created. Once logged into group policy you will want to do the following steps.</p><ol><li>In Server Manager, go to Tools &gt; Group Policy Management.</ol><p><img data-src="/assets/post4/5.png" alt="servermanager" data-proofer-ignore></p><ol><li>From here you will want to expand your forest, expand your domains and the right-click your domain and click to create a new GPO.</ol><p><img data-src="/assets/post4/6.png" alt="servermanager" data-proofer-ignore></p><ol><li>You will be prompted to name your GPO, just name it something important. Then you will want to right-click your newely created policy and press edit. This will bring you to the Group Poilcy Management editor for this specific policy. Here I named my policy WEC Forwarding.</ol><p><img data-src="/assets/post4/7.png" alt="servermanager" data-proofer-ignore></p><ol><li>From here you will first want to expand Computer Configuration &gt; Windows Settings &gt; Security Settings &gt; Restricted Groups. Then you will want to right-click and add a new group.</ol><p><img data-src="/assets/post4/8.png" alt="servermanager" data-proofer-ignore></p><ol><li>Create a new name for the group and name it something appropriate. When adding members you will want to add NT AUTHORITY\Network Service.</ol><p><img data-src="/assets/post4/9.png" alt="servermanager" data-proofer-ignore></p><ol><li>You will then wan to edit System Services which is one down from your current position and make sure that Windows Remote Management is automatically started up on reboot. This keeps persistance for your hosts sending the logs.</ol><p><img data-src="/assets/post4/10.png" alt="servermanager" data-proofer-ignore></p><ol><li>Next you will go under Computer Configurations &gt; Policies &gt; Administrative Templates: &gt; Windows Components &gt; Event forwarding. There will be 2 settings in here that we’re going to change. First you will want to right-click edit Configure forwarder resource usage. Make sure it’s set to Enabled and set the maximum forward rate. In a production server I would set this to around 1000.</ol><p><img data-src="/assets/post4/11.png" alt="servermanager" data-proofer-ignore></p><ol><li>Next you will want to editt Configure target Subscription Manager. Make sure it’s set to Enabled as well and click Show under subscription manager. From here you will want to type this, replacing xxx with your WEC domain name.</ol><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Server=http://xxx:5985/wsman/SubscriptionManager/WEC,Refresh=120
</pre></table></code></div></div><p><img data-src="/assets/post4/12.png" alt="servermanager" data-proofer-ignore></p><p><strong>NOTE</strong> This will set the interval that hosts check for a configuration change every 2 minutes. If you know you won’t be changing your subscription often (like editing your XML query) then I would recommend increasing this amount. Additionally, if you want to encrypt over SSL you will want to set the port to :5986.</p><ol><li>Next you will go one more dowwn to Event Log Service, expand it and go to Security so we can edit Configure Log Access. This gives our WEC the ability to read the logs. Make sure it’s enabled and the type this into the Log Access Portion.</ol><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>O:BAG:SYD:(A;;0xf0005;;;SY)(A;;0x5;;;BA)(A;;0x1;;;S-1-5-32-573)(A;;0x1;;;S-1-5-20)
</pre></table></code></div></div><p><img data-src="/assets/post4/13.png" alt="servermanager" data-proofer-ignore></p><ol><li>After that setting we’re done configuring this group policy! From here you can close out all your windows and validate that the GPO is linked. Before the GPO will take affect however, we have to force an update to systems in our domain in order for them to start pushing logs. As an testing example, on a Windows10 host, I typed the following to update it’s policies and checked my WEC to see if that host was forwarding logs.</ol><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">gpupdate</span><span class="w"> </span><span class="nx">/force</span><span class="w">
</span></pre></table></code></div></div><p><img data-src="/assets/post4/14.png" alt="servermanager" data-proofer-ignore></p><p><img data-src="/assets/post4/15.png" alt="servermanager" data-proofer-ignore></p><p>If you’ve made it to this point congrats, almost done! Now that we have all of our logs centralized we just need to ship those logs to our SIEM. My guide will be using winlogbeats and creating a pipeline into SecurityOnion2 but if you wanted to use Splunk for example, you would just need to install the forwarder here.</p><h1 id="configuring-winlogbeats">Configuring Winlogbeats</h1><p>Now that we are seeing host logs centralized, we need to configure Winlogbeats to ship those logs into our SIEM SecurityOnion2. There are a couple caveats to keep in mind.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>1. Caveat number 1 is that you will need to download the exact verion of Winlogbeat supported by the version of SecurityOnion2 that you're using. To do this, you can log into the SOC and from the downloads page download the correct version. Then you will just need to push this .msi file to your WEC.
</pre></table></code></div></div><p><img data-src="/assets/post4/16.png" alt="servermanager" data-proofer-ignore></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>**QUICKNOTE** You can only ship logs to SecurityOnion2 in either a Standalone or Distributed deployment.

2. Caveat number 2 is that you will need to login to your SO2 manager and open up the firewall so that logs can be sent to your SIEM. This can be done with the following commands where x.x.x.x is your WEC's IP address.
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    <span class="nb">sudo </span>so-allow
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    b
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    x.x.x.x
</pre></table></code></div></div><p><img data-src="/assets/post4/17.png" alt="servermanager" data-proofer-ignore></p><p>Now that we have prepped our deployment we can get started. On your WEC run the .msi file you downloaded earlier from your SO2 instance. During the initial install you can keep all the defaults and once it finishes you can now edit your <em>winlogbeatreference.yml</em> file located in</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>C:\Program Data\Elastic\Beats\winlogbeat\ 
</pre></table></code></div></div><p>I highly recommend using a proficient editor like notepad ++ as you will be making a couple of edits to this file.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>1. First you will want to make sure that setup.dashboards.enabled setting is commented out.
</pre></table></code></div></div><p><img data-src="/assets/post4/18.png" alt="servermanager" data-proofer-ignore></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>2. Next you will want to disable the output.elasticsearch field by also commenting it out.
</pre></table></code></div></div><p>![servermanager](/assets/post4/19.png</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>3. Lastly, you will want to enable your output.logstash ouptut and configure it to send the logs to port 5044 of your SecurityOnion2 Managers IP address.
</pre></table></code></div></div><p><img data-src="/assets/post4/20.png" alt="servermanager" data-proofer-ignore></p><p><strong>NOTE:</strong> Don’t make the same mistake I did. In order for this setup to work properly you will need to make sure taht you can route the traffic coming from your WEC into the Mangaement Interface of your SO2 manager. Usually this involves creating a static route on the firewall/switch where your WEC is and making sure it points to the same network as your SO2 management interface is. You can do a quick sanity check to see if it will work beforehand by typing the following command in powershell on your WEC where x.x.x.x si your SO2 management IP interface address.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Test-netconnection</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="s2">"x.x.x.x"</span><span class="w"> </span><span class="nt">-Port</span><span class="w"> </span><span class="nx">5044</span><span class="w">
</span></pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>The above will tell you if a connection can be established over that port. If you see anything but a success, make sure the so-allow rule wen through and check your routing.
</pre></table></code></div></div><p>Once you’ve fininshed making your changes to the <em>winlogbeatsreference.yml</em> file save it as a new file, naming it something appropriate and put it in the following directory where x.x.x is the version of winlogbeat you have installed.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>C:\Program Files\Elastic\Beats\x.x.x\winlogbeat\
</pre></table></code></div></div><p>You will then want to make sure that this service starts automatically incase of a sudden reboot. Type the following in a Powershell prompt with administrative rights where x.x.x is your version of winlogbeats and y is the new forked file you just created.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">New-Service</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"Winlogbeats"</span><span class="w"> </span><span class="nt">-BinaryPathName</span><span class="w"> </span><span class="s2">"C:\Program Files\Elastic\Beats\x.x.x\winlogbeat.cmd -c y.yml -e"</span><span class="w">
</span></pre></table></code></div></div><p>Lastly you will want to go into your services and enable the new service. It should start and you should now be seeing host logs in your SecurityOnion2 instance. If you receive an error while starting this service, you probably aren’t point to the right reference file. ILf you aren’t seeing data being ingested and the service is working, make sure you have data being forwarded into your WEC and make sure you can still touch the Manager.</p><p><img data-src="/assets/post4/21.png" alt="servermanager" data-proofer-ignore></p><p>You will know you’re successfully ingesting host logs when you log into your SOC and you see log counts from your nodes in your domain.</p><p><img data-src="/assets/post4/22.png" alt="servermanager" data-proofer-ignore></p><h1 id="end">END</h1><p>Thanks for making it this far! There are still some minor adjustments you may want to make in the future such as utilizing syslog and forwarding logs that aren’t domain joined. Maybe I’ll revisit these topics in a later blog post. If you have any questions or want some troubleshooting help feel free to reach out via email, as I’m always willing to try. Have a great rest of your day!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/siem/'>siem</a>, <a href='/categories/activedirectory/'>activedirectory</a>, <a href='/categories/hostlogs/'>hostlogs</a>, <a href='/categories/securityonion/'>securityonion</a>, <a href='/categories/windows/'>windows</a>, <a href='/categories/elastic/'>elastic</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/siem/" class="post-tag no-text-decoration" >siem</a> <a href="/tags/activedirectory/" class="post-tag no-text-decoration" >activedirectory</a> <a href="/tags/hostlogs/" class="post-tag no-text-decoration" >hostlogs</a> <a href="/tags/securityonion/" class="post-tag no-text-decoration" >securityonion</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/elastic/" class="post-tag no-text-decoration" >elastic</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ingesting+Host+Logs+-+Mitchell+Gibson+Docs&url=https%3A%2F%2Ftniconic.github.io%2Fposts%2Fhost_log_ingest%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ingesting+Host+Logs+-+Mitchell+Gibson+Docs&u=https%3A%2F%2Ftniconic.github.io%2Fposts%2Fhost_log_ingest%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftniconic.github.io%2Fposts%2Fhost_log_ingest%2F&text=Ingesting+Host+Logs+-+Mitchell+Gibson+Docs" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/test/">Building a Home Lab</a><li><a href="/posts/zeek_intel/">Utilizing Zeek Intel</a><li><a href="/posts/wec/">Building a Cyber Range PT I</a><li><a href="/posts/network/">Building a Cyber Range PT II</a><li><a href="/posts/host_log_ingest/">Ingesting Host Logs</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/securityonion/">securityonion</a> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/analytics/">analytics</a> <a class="post-tag" href="/tags/pfsense/">pfsense</a> <a class="post-tag" href="/tags/activedirectory/">activedirectory</a> <a class="post-tag" href="/tags/elastic/">elastic</a> <a class="post-tag" href="/tags/hostlogs/">hostlogs</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/wec/"><div class="card-body"> <em class="small" data-ts="1656781200" data-df="ll" > Jul 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a Cyber Range PT I</h3><div class="text-muted small"><p> Intro Hello reader! This is the first post in a series that I’ll be writing detailing how to create a production environment cyber lab. This post will be going over the planning process, networking...</p></div></div></a></div><div class="card"> <a href="/posts/network/"><div class="card-body"> <em class="small" data-ts="1657126800" data-df="ll" > Jul 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a Cyber Range PT II</h3><div class="text-muted small"><p> Cyber Range PT II Welcome back! In part 2 of this blog post we will be configuring our networks, configuring PFSense and joining servers/workstations to our domain. Let’s get started! Where we ...</p></div></div></a></div><div class="card"> <a href="/posts/test/"><div class="card-body"> <em class="small" data-ts="1655658000" data-df="ll" > Jun 19, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a Home Lab</h3><div class="text-muted small"><p> Home Lab Principles I thought it would be fitting for my first post to be about the homelab that I designed, created and built. There are a lot of homelab guides on the internet, but I noticed tha...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/network/" class="btn btn-outline-primary" prompt="Older"><p>Building a Cyber Range PT II</p></a> <a href="/posts/VMWare-VulnCheck/" class="btn btn-outline-primary" prompt="Newer"><p>Validating Vmware Security</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Mitchell Gibson</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/securityonion/">securityonion</a> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/analytics/">analytics</a> <a class="post-tag" href="/tags/pfsense/">pfsense</a> <a class="post-tag" href="/tags/activedirectory/">activedirectory</a> <a class="post-tag" href="/tags/elastic/">elastic</a> <a class="post-tag" href="/tags/hostlogs/">hostlogs</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
